##基于node.js的微信JS-SDK简单应用
要问2015年以来前端界什么最火，那必然是react、angular与H5了，两门热门技术能够流行起来，这很容易理解，而H5能大火起来其背后必然有深层次的原因。

2015年必然是一个不平凡的一年，es6标准发布了，是Hybrid App崛起之年，Web App和Native App各有其强大之处，也有着致命的缺点，人们一边追求native流畅的用户体验，一边同时期望产品能够快速的迭代更新，Hybrid成为必然的趋势。

腾讯一马当先，发布了业内震惊一时的JS-SDK，这对于基于微信的H5开发者来说简直是如降甘露，从此开发者们告别了用箭头来提示右上角可以分享，并且随时可以使用微信的原生能力，微信变成了一个超级浏览器。


#### 微信JS-SDK

微信公众平台面向开发者开放微信内网页开发工具包（微信JS-SDK），通过微信JS-SDK提供的11类接口集，开发者不仅能够在网页上使用微信本身的拍照、选图、语音、位置等基本能力，还可以直接使用微信分享、扫一扫、卡券、支付等微信特有的能力，为微信用户提供更优质的网页体验。

微信JS-SDK提供的11类接口:

- `分享接口`
- `图像接口`
- `音频接口`
- `智能接口`
- `设备信息`
- `界面操作`
- `地理位置`
- `微信扫一扫`
- `微信小店`
- `微信卡券`
- `微信支付`

> 注意：在使用方式上完全相同，唯一需要注意的是，这11类接口并不是都开放的，有些接口非认证用户是没有权限的，比如分享接口，小店接口、卡券接口、支付接口则必须通过微信认证后才能使用。

#### 准备工作

- 1.在微信公众平台申请测试账号，并设置好好 JS 接口安全域名 （注：域名必须可以外网访问）

- 2.查看[微信开发者文档](http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html)


#### 开放必须项

- 1、开发者ID (应用ID和应用密匙)，如图：

<img src="http://7xpwoh.com1.z0.glb.clouddn.com/16-7-17/33478716.jpg" width="500px" />

- 2、在公众号（服务号）设置——功能设置（JS接口安全域名）中填写一个外网可访问的域名
- 3、服务器环境
- 4、简单的后台知识，如node

#### 开发环境的搭建

调试微信接口一直都是一个令人头疼的事情，由于微信接口限制只能在微信浏览器调用，所以一般只能在真机环境下调试，同时JS接口安全域名的限制，让本地调试更加的麻烦。为止我们需要借助两个工具：

- 微信web开发者工具，[下载地址](https://mp.weixin.qq.com/wiki/10/e5f772f4521da17fa0d7304f68b97d7e.html#.E4.B8.8B.E8.BD.BD.E5.9C.B0.E5.9D.80)
- ngrok

> 微信web开发者工具让我们在pc上也能模拟真机微信浏览器，同时集成了chrome的开发者工具，让调试网页更加的便捷。

> ngrok是一个能将本地部署的网站让外网能直接访问到的工具，ngrok使用很简单，下载之后你只有运行命令：`./ngrok 3000`即可，默认会分配随机的二级域名来访问，转发到本机的3000端口。可以通过-help参数来查看详细的说明。运行后如下提示：
<img src="http://7xpwoh.com1.z0.glb.clouddn.com/16-7-17/74619795.jpg" width = '300px' />

> 这时外网可以通过`http://95e02879.ngrok.io`来访问我们内网的`http://127.0.0.1:3000`了，通过ngrok提供的管理界面(`127.0.0.1:4040`)可以清楚的看到当前有哪些连接，以及请求的url，可以进行replay。

> 我们把`http://95e02879.ngrok.io`域名设计到微信公众平台的JS接口安全域名上就可以调试了。
注：每次启动ngrok服务时，二级域名都可能会变化，所以每次都要到公众号平台设置，ngrok提供自定义二级域名的方式启动服务，但是要购买服务，庆幸的是ngrok开源了，可以通过ngrok搭建自己的服务，国内已经有同学搭好了很好用服务，sunny-ngrok（地址：[http://ngrok.cc/](http://ngrok.cc/)），使用方式是一样的，速度很快，不需要翻墙。


至此，我们的接口调试环境基本已经搭建完毕，已经能够做到很好的调试微信接口了。


#### 开始编码

###### 网页授权获取用户基本信息

如果用户在微信客户端中访问第三方网页，公众号可以通过微信网页授权机制，来获取用户基本信息，进而实现业务逻辑。

网页授权流程分为四步：

	1、引导用户进入授权页面同意授权，获取code
	2、通过code换取网页授权access_token（与基础支持中的access_token不同）、openid
	3、如果需要，开发者可以刷新网页授权access_token，避免过期
	4、通过网页授权access_token和openid获取用户基本信息（支持UnionID机制）
	
注意：第一步中redirect_uri必须为安全域名内的链接
	
	









